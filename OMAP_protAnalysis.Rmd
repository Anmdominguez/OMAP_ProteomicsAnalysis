---
title: "OMAP_MSanalysis"
author: "Andrew Dominguez"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




```{r Import .tsv data}
library(readr)

#PC Working Directory
wd <- setwd("C:/Users/anmdo/Desktop/Analysis_Wkspce/archive_2024_05_15__15_13_08/20240515_1239_dominiquez/") 

#Mac Working Directory
#wd <- setwd("/Users/andrewd/Desktop/Analysis_wkspce/OMAP_proteomics") 


dataImport <- readr::read_tsv("Candidates.tsv")
Comparisons <- unique(dataImport$`Comparison (group1/group2)`)
Comparisons

```

```{r remove non-yeast contaminates and append GO terms}
library(tidyverse)
yeastSubset <- dataImport %>% filter(Organisms == "Saccharomyces cerevisiae (strain ATCC 204508 / S288c)")


```

```{r subset on valid comparisons}
DataSubset <- function(Subset) {
  SubsetDF <- subset(yeastSubset, yeastSubset$`Comparison (group1/group2)`== Subset) #input subset here: "ITS2 FLX" 
  SubsetValues <- dplyr::select(SubsetDF,`Comparison (group1/group2)`, Group, `AVG Group Quantity Numerator`, 
                                `AVG Group Quantity Denominator`, `AVG Log2 Ratio`, Ratio, ProteinGroups, 
                                ProteinNames, ProteinDescriptions, Genes, UniProtIds, Organisms,`Protein Coverage`,
                                `Molecular Weight`, `# Unique Total Peptides`, `# Unique Total EG.Id`)
  SubsetValues <- SubsetValues[order(SubsetValues$`AVG Log2 Ratio`),]
  return(SubsetValues)
}
# colList <- colnames(DataSubset)
# colList
```

```{r}
#Comparison subsets 
Pierce_dTvITS2 <- DataSubset("dT-Pierce / ITS2-Pierce")
Pierce_ScrvITS2 <- DataSubset("Scramble-Pierce / ITS2-Pierce")
Pierce_ScrvdT <- DataSubset("Scramble-Pierce / dT-Pierce")
ITS2_DynavPierce <- DataSubset("ITS2-Dyna / ITS2-Pierce")
ITS2_DynavPierce <- DataSubset("dT-Dyna / dT-Pierce")
Dyna_dTvITS2 <- DataSubset("dT-Dyna / ITS2-Dyna")
table(unlist(yeastSubset$`Comparison (group1/group2)`))

```



```{r}
library(clusterProfiler)
library(org.Sc.sgd.db)
library(AnnotationDbi)

GO_call_denom <- function(Subset) {
  EnrichedGenes <- Subset[Subset$`AVG Log2 Ratio` < -1, ]
  GO_annotation <- EnrichedGenes$Genes
  GO_Results <- enrichGO(gene = GO_annotation, OrgDb = "org.Sc.sgd.db", keyType = "COMMON", ont = "CC")
  #GO_Results <- data.frame(GO_Results)
  return(GO_Results)
}


GO_call_numer <- function(Subset) {
  EnrichedGenes <- Subset[Subset$`AVG Log2 Ratio` > 1, ]
  GO_annotation <- EnrichedGenes$Genes
  GO_Results <- enrichGO(gene = GO_annotation, OrgDb = "org.Sc.sgd.db", keyType = "COMMON", ont = "CC")
  #GO_Results <- data.frame(GO_Results)
  return(GO_Results)
}

```

```{r}
#ITS2 and dT verses scramble
GO_Pierce_ITS2 <- GO_call_denom(Pierce_ScrvITS2)
GO_Pierce_ScrITS2 <- GO_call_numer(Pierce_ScrvITS2)

GO_Pierce_dT <- GO_call_denom(Pierce_ScrvdT)
GO_Pierce_ScrdT <- GO_call_numer(Pierce_ScrvdT)

#ITS2 vs dT using Pierce beads
GO_ITS2_Pierce_dTvITS2 <- GO_call_denom(Pierce_dTvITS2)
GO_dT_Pierce_dTvITS2 <- GO_call_numer(Pierce_dTvITS2)

#ITS2 vs dT using Dynabeads
#GO_ITS2_Dyna_dTvITS2 <- GO_call_denom(Dyna_dTvITS2)
#GO_dT_Dyna_dTvITS2 <- GO_call_numer(Dyna_dTvITS2)

#ITS2 Pierce vs Dynabeads
#GO_ITS2_Pierce <- GO_call_denom(ITS2_DynavPierce)
#GO_ITS2_Dyna <- GO_call_numer(ITS2_DynavPierce)

#dT Pierce vs Dynabeads
#GO_dT_Pierce <- GO_call_denom(ITS2_DynavPierce)
#GO_dT_Dyna <- GO_call_numer(ITS2_DynavPierce)

```


```{r GO barplots}
library(patchwork)

GO_Plot <- function(Data){
  GO_plot <- plot(barplot(Data, showCategory = 20))
  return(GO_plot)  
}

DistPlot <- ggplot(data=Pierce_ScrvITS2, aes(x=`AVG Group Quantity Denominator`, y=`AVG Group Quantity Numerator`)) + 
  geom_point(alpha = 0.1) +
  coord_cartesian(xlim = c(0, 500), ylim = c(0, 500)) +
  geom_abline(slope = 1, intercept = 0) +
  geom_point(data = Pierce_ScrvITS2 %>% filter(`AVG Log2 Ratio` > 1), color = "darkorange", alpha = 0.75) +
  geom_point(data = Pierce_ScrvITS2 %>% filter(`AVG Log2 Ratio` < -1), color = "dodgerblue3", alpha = 0.75)
  
DistPlot
plot_GO_Pierce_ITS2 <- plot(barplot(GO_Pierce_ITS2, showCategory = 10 ) + ggtitle("Proteins enriched in ITS2-targeted labeling"))
plot_GO_Pierce_dT <- plot(barplot(GO_Pierce_dT, showCategory = 10) )

plot_GO_Pierce_dTvITS2 <- plot(barplot(GO_dT_Pierce_dTvITS2, showCategory = 10 ) + ggtitle("Genes enriched from P(A)-OMAP"))
plot_GO_Pierce_ITS2vsdT <- plot(barplot(GO_ITS2_Pierce_dTvITS2, showCategory = 10 ) + ggtitle("Genes enriched from ITS2-OMAP"))






plot_GO_ITS2_Pierce_dTvITS2 <- plot(barplot(GO_Pierce_ITS2, showCategory = 10) + ggtitle("Proteins enriched in ITS2-targeted labeling over dT"))
#plot_GO_ITS2_Pierce_dTvITS2 <- plot(barplot(GO_Pierce_dT, showCategory = 10))



```